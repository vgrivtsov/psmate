<!DOCTYPE html>
    
{% extends "layouts/companieslayout.html" %}

{% load static %}
{% load widget_tweaks %}

{% block breadcrumbs %}
{{ block.super }} <a class="breadcrumb-item" href="{% url 'organization-profile' company.id %}">Организация: «{{company.e_op_form}}» {{company.e_name}}</a>
{% endblock %}

{% block companyprofile %}


{% if company.regname_id == user.id %}
<!--Card company info-->
<div class="col-4 mb-4">
  <div class="card">
    <div class="card-body">
      <div class="clearfix">
        <a href="{% url 'organization-settings' company.id %}">
         <i class="fa fa-pencil float-right"></i>
        </a>
      </div>
      <h5 class="card-title">Информация об организации</h5>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>
                Название
              </th>
              <th>
                {{company.e_director}}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
               «{{company.e_op_form}}» {{company.e_name}}
              </td>
              <td>{{company.e_name_ul|first|capfirst}}. {{company.e_otch_ul|first|capfirst}}. {{company.e_fam_ul|capfirst}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
 
<!--/.Card company info-->

<div class="py-5">
  <h4>Подразделения</h4>
</div>



<div id="Departs">
{% if departs%} 
<table id="tableDeparts" class="table table-striped"> 
  <thead>
    <tr>
      <th>№</th>
      <th>Название</th>
      <th>Должность руководителя</th>
      <th>ФИО руководителя</th>
      <th>Телефон</th>
    </tr>
  </thead>
  <tbody>
  {% for dep in departs %}    
    <tr id="depart_{{ forloop.counter }}" class="accordion-toggle" data-toggle="collapse" data-parent="#Departs" data-target=".docsDepart_{{ forloop.counter }}">
      <th scope="row">{{ forloop.counter }}.</th>
      <td>{{dep.name}}</td>
      <td>{{dep.cheef}}</td>
      <td>{{dep.cheef_name|first|capfirst}}. {{dep.cheef_otch|first|capfirst}}. {{dep.cheef_fam|capfirst}}</td>
      <td>{{dep.phone}}</td>      
      <td align="right"><a class="btn btn-warning btn-sm" href="{% url 'editdepart' company.id dep.id %}">Изменить</a></td>
      <td><i class="indicator fa fa-chevron-up pull-right"></i>
    </tr>
    <tr>
        <td colspan="3" class="hiddenRow">
            <div class="accordion-body collapse docsDepart_{{ forloop.counter }}" id="depaccordion_{{ forloop.counter }}">
                <table>
                    <tr>
                        <td>Revealed item 1</td>
                    </tr>
                    <tr>
                         <td><a class="btn btn-mdb-color btn-sm" href="{% url 'org-search-jobtitles' company.id dep.id %}?search=''">Добавить должностную инструкцию</a></td>
                    </tr>

                </table>
            </div>
        </td>
    </tr>
<script>
$('#depaccordion_{{ forloop.counter }}').on('shown.bs.collapse', function () {
    $("#depart_{{ forloop.counter }} i.indicator").removeClass("fa fa-chevron-up").addClass("fa fa-chevron-down");
});
$('#depaccordion_{{ forloop.counter }}').on('hidden.bs.collapse', function () {
    $("#depart_{{ forloop.counter }} i.indicator").removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up");
});
</script>
  {% endfor %}      
  </tbody>
</table>
{% endif %}
 </div> 
{% if departs|length < 2 %}
  <a class="btn btn-mdb-color btn-sm waves-effect" href="{% url 'registerdepart' company.id%}">Добавить подразделение</a>
  {% else %}
  <p class="font-italic text-muted">Достигнут лимит на создание подразделений в организации «{{company.e_op_form}}» {{company.e_name}}</p>
{% endif %}

{% else %}
  <div class="container-fluid py-5 card text-center z-depth-2">
   <div class="card-body">
    <h5>У вас нет такой зарегестрированой организации</h5> {{company.regname_id}}
   </div>
  </div>
{% endif %}
{% endblock %}


