<!DOCTYPE html>
    
{% extends "layouts/companieslayout.html" %}

{% load static %}
{% load widget_tweaks %}

{% block breadcrumbs %}
{{ block.super }} <a class="breadcrumb-item" href="{% url 'organization-profile' company.id %}">Организация: «{{company.e_op_form}}» {{company.e_name}}</a>
{% endblock %}

{% block companyprofile %}
<style>
 
.oiindepartcard{	
	margin-top: 0;
    margin-bottom: 1.0rem;
    text-align: left;
    height: 175px;
    box-shadow: 12px 15px 20px 0px rgba(46,61,73,0.15);
    border-radius: 4px;
    transition: all 0.3s ease;
}
.oiindepartcard .fa{
	position: relative;
    font-size: 50px;
}
.oiindepartcard-topimage_header{
padding: 10px;

}
a.oiindepartcard:hover, .oiindepartcard-topimage:hover {
    box-shadow: 2px 4px 8px 0px rgba(46,61,73,0.2);
}
.oiindepartcard-topimage a {
    width: 100%;
    height: 100%;
    display: block;
}

}
.oiindepartcard-topimage a {
    border-bottom: none;
    text-decoration: none;
    color: #525c65;
    transition: color 0.3s ease;
}
 
 
 
</style>

{% if company.regname_id == user.id %}
<!--Card company info-->
<div class="col-4 mb-4">
  <div class="card">
    <div class="card-body">
      <div class="clearfix">
        <a href="{% url 'organization-settings' company.id %}">
         <i class="fa fa-pencil float-right"></i>
        </a>
      </div>
      <h5 class="card-title">Информация об организации</h5>
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>
                Название
              </th>
              <th>
                {{company.e_director}}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>
               «{{company.e_op_form}}» {{company.e_name}}
              </td>
              <td>{{company.e_name_ul|first|capfirst}}. {{company.e_otch_ul|first|capfirst}}. {{company.e_fam_ul|capfirst}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
 
<!--/.Card company info-->

<div class="py-5">
  <h4>Подразделения</h4>
</div>



<div id="Departs">
{% if departs%} 
<table id="tableDeparts" class="table table-striped"> 
  <thead>
    <tr>
      <th>№</th>
      <th>Название</th>
      <th>Должность руководителя</th>
      <th>ФИО руководителя</th>
      <th>Телефон</th>
    </tr>
  </thead>
  <tbody>
  {% for dep in departs %}    
    <tr id="depart_{{ forloop.counter }}" class="accordion-toggle" data-toggle="collapse" data-parent="#Departs" data-target=".docsDepart_{{ forloop.counter }}">
      <th scope="row">{{ forloop.counter }}.</th>
      <td>{{dep.name}}</td>
      <td>{{dep.cheef}}</td>
      <td>{{dep.cheef_name|first|capfirst}}. {{dep.cheef_otch|first|capfirst}}. {{dep.cheef_fam|capfirst}}</td>
      <td>{{dep.phone}}</td>      
      <td align="right"><a class="btn btn-warning btn-sm" href="{% url 'editdepart' company.id dep.id %}">Изменить</a></td>
      <td><i class="indicator fa fa-chevron-up pull-right"></i></td>
    </tr>
    <tr>
     <td colspan="3" class="hiddenRow">
       <div class="accordion-body collapse docsDepart_{{ forloop.counter }}" id="depaccordion_{{ forloop.counter }}">
         {% if ois%}
	       <div class="row">
          {% for oi in ois %} {% if oi.departs_id == dep.id %}
	           <div class="col-md-2">
              <a href="{% url 'org-official-instructions' company.id oi.departs_id oi.slug%}">
	               <div class="oiindepartcard oiindepartcard-topimage" style="background-color: #2b579a">                                    
                   <div class="oiindepartcard-topimage_header" style="color:white">
                     <center ><i class="fa fa-file-word-o" ></i> </center>
                     <small>Должностная инструкция</small>
                     {% if oi.name|length > 30 %} <!--truncate long JT name-->
                      <small data-toggle="tooltip" data-placement="right" title="{{oi.name}}">{{oi.short|capfirst}}</small>
                     {% else %}
                      <small>{{oi.name|capfirst}}</small>
                     {% endif %}                               
                   </div>                              
                </div>
              </a>
            </div>
          {% endif %}{% endfor %}
        </div>                         
          {% endif %} 
          <div class="row">
           <a class="btn btn-mdb-color btn-sm" href="{% url 'org-search-jobtitles' company.id dep.id %}?search=''">Добавить должностную инструкцию</a>
          </div>  
         </div>
       </td>
    </tr>
<script>
$('#depaccordion_{{ forloop.counter }}').on('shown.bs.collapse', function () {
    $("#depart_{{ forloop.counter }} i.indicator").removeClass("fa fa-chevron-up").addClass("fa fa-chevron-down");
});
$('#depaccordion_{{ forloop.counter }}').on('hidden.bs.collapse', function () {
    $("#depart_{{ forloop.counter }} i.indicator").removeClass("fa fa-chevron-down").addClass("fa fa-chevron-up");
});
</script>
  {% endfor %}      
  </tbody>
</table>
{% endif %}
 </div> 
{% if departs|length < 2 %}
  <a class="btn btn-mdb-color btn-sm waves-effect" href="{% url 'registerdepart' company.id%}">Добавить подразделение</a>
  {% else %}
  <p class="font-italic text-muted">Достигнут лимит на создание подразделений в организации «{{company.e_op_form}}» {{company.e_name}}</p>
{% endif %}

{% else %}
  <div class="container-fluid py-5 card text-center z-depth-2">
   <div class="card-body">
    <h5>У вас нет такой зарегестрированой организации</h5> {{company.regname_id}}
   </div>
  </div>
{% endif %}
{% endblock %}


